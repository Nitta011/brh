Códigos utilizados na semana 3

/* FILTRAR DEPENDENTES */
SELECT  BRH.COLABORADOR.NOME AS NOME_COLABORADOR, 
BRH.DEPENDENTE.NOME AS NOME_DEPENDENTE, 
BRH.DEPENDENTE.DATA_NASCIMENTO, 
BRH.DEPENDENTE.PARENTESCO 
FROM BRH.DEPENDENTE 
LEFT JOIN BRH.COLABORADOR 
ON BRH.DEPENDENTE.COLABORADOR = BRH.COLABORADOR.MATRICULA
WHERE EXTRACT (MONTH FROM BRH.DEPENDENTE.DATA_NASCIMENTO) >= 04 
AND 
EXTRACT (MONTH FROM BRH.DEPENDENTE.DATA_NASCIMENTO) <= 06
OR 
BRH.DEPENDENTE.NOME LIKE '%H%'
ORDER BY NOME_COLABORADOR;




/* LISTAR COLABORADOR COM O MAIOR SALARIO*/ 
SELECT * FROM BRH.COLABORADOR 
WHERE BRH.COLABORADOR.SALARIO = 
(SELECT MAX(BRH.COLABORADOR.SALARIO) 
FROM BRH.COLABORADOR);



/* RELATÓRIO SENIORIDADE */
SELECT A.MATRICULA, 
A.NOME, 
A.SALARIO, 
(CASE 
WHEN A.SALARIO <=3000 THEN 'JÚNIOR' 
WHEN A.SALARIO >= 3001 AND A.SALARIO <=6000 THEN 'PLENO'
WHEN A.SALARIO >= 6001 AND A.SALARIO <=20000 THEN 'SÊNIOR'
WHEN A.SALARIO >20000 THEN 'CORPO DIRETOR'
END ) AS SENIORIDADE
FROM BRH.COLABORADOR A
ORDER BY SENIORIDADE,A.NOME;




/* LISTAR COLABORADORES EM PROJETOS */

SELECT B.NOME AS NOME_DEP, 
E.NOME AS NOME_PROJETO, 
COUNT (*) AS QTD_PESSOAS 
FROM BRH.PROJETO E
INNER JOIN BRH.ATRIBUICAO D
ON E.ID = D.PROJETO
INNER JOIN BRH.COLABORADOR A
ON A.MATRICULA = D.COLABORADOR
INNER JOIN BRH.DEPARTAMENTO B
ON B.SIGLA = A.DEPARTAMENTO
GROUP BY B.NOME,
E.NOME
ORDER BY B.NOME,
E.NOME;





/* COLABORADOR COM MAIS DEPENDENTES */
SELECT A.NOME, 
COUNT (*) AS QTD_DEPENDENTES 
FROM BRH.DEPENDENTE B 
INNER JOIN BRH.COLABORADOR A
ON A.MATRICULA = B.COLABORADOR
GROUP BY A.NOME,B.COLABORADOR
HAVING COUNT (*) >= 2
ORDER BY QTD_DEPENDENTES DESC,
A.NOME ASC;


/* LISTAR FAIXA ETARIA DOS DEPENDENTES */
SELECT B.CPF, 
B.NOME AS NOME_DEPENDENTE, 
B.DATA_NASCIMENTO, 
B.PARENTESCO, 
A.MATRICULA, 
TRUNC (to_char(SYSDATE - B.DATA_NASCIMENTO)/365.25) as IDADE,
(CASE 
WHEN (SYSDATE - B.DATA_NASCIMENTO)/365 <18 THEN 'MENOR DE IDADE'
ELSE 'MAIOR DE IDADE'
END ) AS FAIXA_ETARIA
FROM BRH.COLABORADOR A
INNER JOIN BRH.DEPENDENTE B
ON A.MATRICULA = B.COLABORADOR
ORDER BY A.MATRICULA, 
B.NOME;



/* RELATÓRIO PLANO DE SAÚDE */

/* VW_SENI_IDADE */
SELECT B.CPF, 
B.NOME AS NOME_DEPENDENTE,B.PARENTESCO, 
B.DATA_NASCIMENTO, 
TRUNC (TO_CHAR(SYSDATE - B.DATA_NASCIMENTO)/365.25) as IDADE,
(CASE 
WHEN (SYSDATE - B.DATA_NASCIMENTO)/365 <18 THEN 'MENOR DE IDADE'
ELSE 'MAIOR DE IDADE'
END ) AS FAIXA_ETARIA, 
A.MATRICULA,
A.NOME AS NOME_COLABORADOR, 
A.SALARIO, 
(CASE 
WHEN A.SALARIO <=3000 THEN 'JÚNIOR' 
WHEN A.SALARIO >= 3001 AND A.SALARIO <=6000 THEN 'PLENO'
WHEN A.SALARIO >= 6001 AND A.SALARIO <=20000 THEN 'SÊNIOR'
WHEN A.SALARIO >20000 THEN 'CORPO DIRETOR'
END ) AS SENIORIDADE
FROM BRH.COLABORADOR A
LEFT JOIN BRH.DEPENDENTE B
ON A.MATRICULA = B.COLABORADOR
ORDER BY A.MATRICULA, 
B.NOME, 
SENIORIDADE;
/* VW_SENI_IDADE */



/* VW_PAGAR_SENIORIDADE */
SELECT DISTINCT NOME_COLABORADOR, 
MATRICULA, 
(CASE
WHEN SENIORIDADE = 'CORPO DIRETOR' THEN SALARIO*0.05
WHEN SENIORIDADE = 'SÊNIOR' THEN SALARIO*0.03
WHEN SENIORIDADE = 'PLENO' THEN SALARIO*0.02
WHEN SENIORIDADE = 'JÚNIOR' THEN SALARIO*0.01
END ) AS PS
FROM VW_SENI_IDADE;
/* VW_PAGAR_SENIORIDADE */



/* VW_PS_DEPENDENTE */
SELECT V.MATRICULA, V.NOME_COLABORADOR, SUM(
CASE 
WHEN PARENTESCO = 'CÃ´njuge' THEN ('100')
WHEN IDADE <18 THEN ('25')
WHEN IDADE >= 18 THEN ('50')
END ) AS PLANO_SAUDE 
FROM VW_SENI_IDADE V
INNER JOIN VW_PAGAR_SENIORIDADE P
ON P.MATRICULA = V.MATRICULA 
GROUP BY V.MATRICULA, 
V.NOME_COLABORADOR 
ORDER BY V.NOME_COLABORADOR;
/* VW_PS_DEPENDENTE */



/* SELECT PARA TRAZER OS RESULTADOS */
SELECT V.NOME_COLABORADOR,
SUM(NVL(V.PLANO_SAUDE,0) + P.PS) AS TOTAL_PAGAR 
FROM VW_PAGAR_DEPENDENTE V 
INNER JOIN VW_PAGAR_SENIORIDADE P
ON V.MATRICULA = P.MATRICULA 
GROUP BY V.NOME_COLABORADOR
ORDER BY V.NOME_COLABORADOR;



/* EXERCÍCIO PAGINAR LISTAGEM DE COLABORADORES */
SELECT * FROM (
SELECT ROWNUM AS LINHA, C.*
FROM BRH.COLABORADOR C
ORDER BY NOME)
--WHERE LINHA >=1 AND LINHA <=10 (1A PAGINA)
WHERE LINHA >= 11 AND LINHA <=20 -- (2A PAGINA)
-- WHERE LINHA >=21 AND LINHA <= 30 (3A PAGINA)
